pico-8 cartridge // http://www.pico-8.com
version 27
__lua__

actors = {}
DEBUG = true
t = 0
gravity = 1
function _init()
	player = create_player(64, 64)

	add(actors,player)
	for i=1,4 do
		create_coin(rndi(7,1)*16, 100)
	end
end

function _update()
	if btn(0) then player:move(-1) end
	if btn(1) then player:move(1) end
	player:update_pos()
	for a in all(actors) do
		a:move()
	end
	t+=1
end

function _draw()
	cls()
	map(0,0,0,0,16,16)


	for a in all(actors) do
		a:draw()
	end

end



function create_actor(x,y,width,height,sprite)
	local a = {
		x = x,
		y = y,
		width = width,
		height = height,
		dx = 0,
		dy = 0,
		sprite = sprite,
		debug_text = ' ',
		draw = function(self) 
			spr(self.sprite, self.x, self.y)
			if (DEBUG) then 
				--rect(self.x,self.y,self.x+self.width-1,self.y+self.height-1)
				print(self.debug_text, self.x+self.width, self.y-8)
			end
		end,
		move = function(self)

		end
	}
	add(actors,a)
	return a
end

function create_player(x,y)
	local a = create_actor(x,y,8,8,0)
	
	a.move = move_player
	a.update_pos = update_pos
	a.check_collisions = check_collisions
	a.dx = 0
	a.dy = 0
	a.gravity = 10
	a.jump = jump

	return a
end

function create_coin(x,y)
	local a = create_actor(x,y,8,8, 48)
	
	local move = function(self)
		self.y -= sin((self.x+t)/20)/2
		--self.x += cos((self.offset+t)/20)/2
	end
	a.move = move
	a.offset = rnd(128)

	return a
end

--[[ function collisions()
	for i=1,#actors do
		for j=i+1,#actors do
			if (touching())
			collide(actors[i],actors[j])
		end
	end
end ]]

function move_player(self, ddx)
	if (not ddx) return
	self.dx += ddx
	player.debug_text = self.dx
	--self.dy = ((ddy or 0) * self.dy) + self.gravity

end

function update_pos(self)
	self.dy = gravity
	if (btnp(2)) self:jump()
	self.dx *= 0.5
	local bottom = self.y + self.height
	for y = 0, self.dy do
		if (is_solid(self.x + self.width/2, bottom + y) and self.dy > 0) then
			self.dy = 0
		end
	end
	
	self.x += self.dx;
	self.y += self.dy;
	if (self.x > 128) self.x = 0
	if (self.x < 0) self.x = 120
end

function jump(self)
	self.dy = -gravity
end

function check_collisions(self)
	--[[for a in all(actors) do
		if (not(self == a)) then
			if (colliding(self, a)) then
				print(0)
				return true
			end
		end
	end]]--

	return false
end	

function is_solid(x,y) --Check if a point is solid
	local val = mget(flr(x/8), flr((y-1)/8))
	return fget(val,0)
end
	

function rndi(max, min) --Return a random number from min-max inclusive
	return (flr(rnd(max)) + min)
end

function colliding(rect1, rect2)
	return (rect1.x < rect2.x + rect2.width and
		rect1.x + rect1.width > rect2.x and
		rect1.y < rect2.y + rect2.height and
		rect1.y + rect1.height > rect2.y)
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333333000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03bbbbb0003333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b7b3b7003bbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbb3bb00b7b3b700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbbbb00bbb3bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0000b0bbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccccccccccccccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccccccccccccccaaccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccccc777cccccaa7acc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ccccccccc77777ccccaaaacc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ccccccccc677777cccaaaacc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccccc6667ccccaaaacc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccccccccccccccaaccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccccccccccccccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88882888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88882888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88882888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88288888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88288888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88288888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0009aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009aaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009aaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009aaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009aaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0009aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101011101010101010121010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101012101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101011101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010121010101010101011101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
